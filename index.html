<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GreenLog</title>
    <!-- 外部ファイルを読み込まず、この1枚にすべて詰め込みます -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/lucide-static@0.344.0/font/lucide.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-stone-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // アイコンの代わり（Lucide Fontを使用）
        const Icon = ({ name, size = 24, className = "" }) => (
            <i className={`lucide-${name} ${className}`} style={{ fontSize: size }}></i>
        );

        const App = () => {
            const [plants, setPlants] = useState(() => {
                const saved = localStorage.getItem('greenlog_data');
                return saved ? JSON.parse(saved) : [];
            });
            const [activeTab, setActiveTab] = useState('list');
            const [selectedPlantId, setSelectedPlantId] = useState(null);
            const [newPlant, setNewPlant] = useState({ name: '', species: '', image: null });

            // データをスマホ本体に保存
            useEffect(() => {
                localStorage.setItem('greenlog_data', JSON.stringify(plants));
            }, [plants]);

            const handleImage = (e, callback) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => callback(reader.result);
                    reader.readAsDataURL(file);
                }
            };

            const addPlant = () => {
                if (!newPlant.name) return;
                const plant = {
                    id: Date.now().toString(),
                    ...newPlant,
                    dateAdded: new Date().toLocaleDateString(),
                    logs: []
                };
                setPlants([plant, ...plants]);
                setNewPlant({ name: '', species: '', image: null });
                setActiveTab('list');
            };

            const selectedPlant = plants.find(p => p.id === selectedPlantId);

            return (
                <div className="min-h-screen pb-20">
                    <header className="bg-emerald-800 text-white p-5 sticky top-0 z-50 shadow-md flex justify-between items-center">
                        {activeTab === 'list' ? (
                            <div className="flex items-center gap-2">
                                <Icon name="leaf" size={20} />
                                <h1 className="text-xl font-bold tracking-tighter">GreenLog</h1>
                            </div>
                        ) : (
                            <button onClick={() => setActiveTab('list')} className="p-1">
                                <Icon name="arrow-left" />
                            </button>
                        )}
                        <Icon name="user" size={20} />
                    </header>

                    <main className="max-w-md mx-auto p-4">
                        {activeTab === 'list' && (
                            <div className="space-y-6">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-black text-stone-800">マイガーデン</h2>
                                    <button onClick={() => setActiveTab('add')} className="bg-emerald-600 text-white p-4 rounded-2xl shadow-lg active:scale-95 transition">
                                        <Icon name="plus" />
                                    </button>
                                </div>
                                
                                {plants.length === 0 ? (
                                    <div className="text-center py-20 bg-white rounded-3xl border-2 border-dashed border-stone-200 text-stone-400">
                                        <p>右上の ＋ から植物を登録しましょう</p>
                                    </div>
                                ) : (
                                    plants.map(p => (
                                        <div key={p.id} onClick={() => { setSelectedPlantId(p.id); setActiveTab('detail'); }} className="bg-white rounded-3xl shadow-sm flex overflow-hidden border border-stone-100 mb-4 active:bg-stone-50 transition">
                                            <div className="w-24 h-24 bg-stone-100 flex-shrink-0">
                                                {p.image ? <img src={p.image} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center text-stone-200"><Icon name="leaf" /></div>}
                                            </div>
                                            <div className="p-4 flex flex-col justify-center">
                                                <h3 className="font-bold text-lg">{p.name}</h3>
                                                <p className="text-xs text-emerald-600 font-bold">{p.species || '種類未設定'}</p>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        )}

                        {activeTab === 'add' && (
                            <div className="bg-white p-8 rounded-3xl shadow-xl space-y-6">
                                <h2 className="text-2xl font-bold">植物を登録</h2>
                                <input type="text" className="w-full bg-stone-50 p-4 rounded-xl outline-none border border-stone-100" placeholder="名前 (例: パキラ)" value={newPlant.name} onChange={e => setNewPlant({...newPlant, name: e.target.value})} />
                                <input type="text" className="w-full bg-stone-50 p-4 rounded-xl outline-none border border-stone-100" placeholder="種類 (例: 観葉植物)" value={newPlant.species} onChange={e => setNewPlant({...newPlant, species: e.target.value})} />
                                <div className="flex items-center gap-4">
                                    <label className="cursor-pointer bg-stone-100 w-20 h-20 rounded-xl flex items-center justify-center border-2 border-dashed border-stone-200">
                                        <Icon name="camera" className="text-stone-400" />
                                        <input type="file" accept="image/*" className="hidden" onChange={e => handleImage(e, (img) => setNewPlant({...newPlant, image: img}))} />
                                    </label>
                                    {newPlant.image && <img src={newPlant.image} className="w-20 h-20 object-cover rounded-xl" />}
                                </div>
                                <button onClick={addPlant} className="w-full bg-emerald-600 text-white py-4 rounded-xl font-bold shadow-lg">登録する</button>
                            </div>
                        )}

                        {activeTab === 'detail' && selectedPlant && (
                            <div className="space-y-6">
                                <div className="relative h-64 -mx-4 -mt-4 mb-6">
                                    {selectedPlant.image ? <img src={selectedPlant.image} className="w-full h-full object-cover" /> : <div className="w-full h-full bg-stone-200 flex items-center justify-center"><Icon name="leaf" size={48} /></div>}
                                    <div className="absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/60 to-transparent text-white">
                                        <h2 className="text-3xl font-black">{selectedPlant.name}</h2>
                                        <p className="opacity-80">{selectedPlant.species}</p>
                                    </div>
                                </div>
                                <div className="bg-white p-6 rounded-3xl shadow-sm text-center">
                                    <p className="text-stone-400 text-sm">記録機能などは、画面が表示された後に</p>
                                    <p className="text-stone-400 text-sm">少しずつ追加していきましょう！</p>
                                </div>
                                <button onClick={() => {
                                    if(confirm('削除しますか？')) {
                                        setPlants(plants.filter(p => p.id !== selectedPlant.id));
                                        setActiveTab('list');
                                    }
                                }} className="w-full text-red-400 text-sm font-bold py-4">この植物を削除する</button>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
